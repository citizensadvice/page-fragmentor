let e=NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT;class t extends Map{get(e){let t;if(this.has(e))return super.get(e);if(e.nodeType===Node.TEXT_NODE){let n=new Range;n.selectNode(e),t=n.getBoundingClientRect()}else t=e.getBoundingClientRect();return this.set(e,t),t}acceptNode(e){return 0===this.get(e).height?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}class n{constructor({rectFilter:e,nodeRules:t,root:n}){this.rectFilter=e,this.nodeRules=t,this.root=n,this.type="base"}get force(){return!1}get avoid(){return!1}get overflowing(){return this.root.scrollHeight>this.root.clientHeight}range(){return null}get rootRect(){return this.rectFilter.get(this.root)}}function o(e,t){return parseFloat(e.getPropertyValue(t))||0}function r(e){return Math.max(0,Math.max(0,...e.filter(e=>e>=0))+Math.min(0,...e.filter(e=>e<0)))}function i(e,t,n){let i=0,a=e.parentNode,d=e.nodeType===Node.ELEMENT_NODE?window.getComputedStyle(e):{getPropertyValue:()=>0},s=[o(d,"margin-bottom")];for(n&&(i+=o(d,"padding-bottom"),i+=o(d,"border-bottom-width"));a&&!a.contains(t);){var l;o(l=d=window.getComputedStyle(a),"padding-bottom")||o(l,"border-bottom-width")||l.display.includes("inline")||"visible"!==l.overflow||"none"!==l.float?(i+=r(s),s=[o(d,"margin-bottom")],i+=o(d,"padding-bottom"),i+=o(d,"border-bottom-width")):s.push(o(d,"margin-bottom")),a=a.parentNode}return i+r(s)}class a extends n{constructor(...e){super(...e),this.nodes=[],this.type="inline"}get overflowing(){return this.rectFilter.get(this.firstNode).top>this.rootRect.bottom}range({disableRules:e=[],avoidDepth:t=0}={}){let{widows:n,orphans:o}=this.containerRules;if(0===n&&0===o||!(e.includes(4)&&this.containerRules.breakInsideAvoid<=t)&&this.containerRules.breakInsideAvoid)return null;let r=this.findLineBoxRange(e.includes(3)),i=this.findFirstOverflowingNodeRange(),a=r||i;if(r&&i&&(a=1===r.compareBoundaryPoints(Range.START_TO_START,i)?r:i),!a)return null;let d=new Range;return d.setStart(a.startContainer,a.startOffset),d.setEndAfter(this.root.lastChild),d}findLineBoxRange(e){let t,{widows:n,orphans:o}=this.containerRules;n=n||2,o=o||2,e&&(n=1,o=1);let r=[],i=!1;for(let e of function*(e){let t=window.getSelection(),n=e.find(e=>e.nodeType===Node.TEXT_NODE),o=[...e].reverse().find(e=>e.nodeType===Node.TEXT_NODE);if(!n)return;let r=new Range;r.setStart(n,0),r.setEnd(o,o.data.length),t.empty(),t.addRange(r),t.collapseToStart();let i=null;for(;;){t.modify("extend","forward","line");let n=t.getRangeAt(0);if(i&&n.setStart(i.endContainer,i.endOffset),n.collapsed)return;if(0===n.endOffset&&n.endContainer.nodeType===Node.ELEMENT_NODE){let t=e.find(e=>e.nodeType===Node.TEXT_NODE&&e!==n.endContainer&&1===n.comparePoint(e,0));t&&n.setEndBefore(t)}if(-1===r.compareBoundaryPoints(Range.END_TO_END,n)&&n.setEnd(r.endContainer,r.endOffset),i&&0===n.compareBoundaryPoints(Range.START_TO_START,i)||(yield n,0===r.compareBoundaryPoints(Range.END_TO_END,n)))break;i=n.cloneRange()}}(this.nodes)){if(!i&&e.getBoundingClientRect().bottom>this.rootRect.bottom-this.bottomSpace&&(i=e,t=r.length),i&&r.length>t+n-1)break;r.push(e)}if(void 0!==t){if(t<o)return null;r=r.slice(o)}return 1===r.length?null:r[r.length-n]||null}findFirstOverflowingNodeRange(){let e=this.nodes.find(e=>this.rectFilter.get(e).bottom>this.rootRect.bottom-i(e,this.root));if(!e||e.nodeType===Node.TEXT_NODE||e===this.firstNode)return null;let t=new Range;return t.setStartBefore(e),t}get container(){if(this._container)return this._container;let e=new Range;e.setStartBefore(this.firstNode),e.setEndAfter(this.lastNode);let t=e.commonAncestorContainer;return t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),this._container=t,t}get bottomSpace(){return this._bottomSpace??=i(this.container,this.root,!0)}get containerRules(){return this._containerRules??=this.nodeRules.get(this.container)}get firstNode(){return this.nodes[0]}get lastNode(){return this.nodes[this.nodes.length-1]}}class d extends n{constructor(...e){super(...e),this.leadingNodes=[],this.trailingNodes=[]}get force(){return this._force??=this.leadingNodes.some(e=>"page"===this.nodeRules.get(e).breakBefore)||this.trailingNodes.some(e=>"page"===this.nodeRules.get(e).breakAfter)}get overflowing(){return this.leadingNodes.some(this.hasLeadingOverflow,this)||this.trailingNodes.some(this.hasTrailingOverflow,this)}get avoid(){return this.leadingNodes.some(e=>["avoid","avoid-page"].includes(this.nodeRules.get(e).breakBefore))||this.trailingNodes.some(e=>["avoid","avoid-page"].includes(this.nodeRules.get(e).breakAfter))}get bottom(){let e=0;for(let t of this.trailingNodes){let n=this.getBottom(t);if(n<e)break;e=n}return e}range({disableRules:e=[],avoidDepth:t=0}={}){let{node:n,force:o,avoid:r}=this;if(!n||n===Node.ELEMENT_NODE||!o&&this.nodeRules.get(n).breakInsideParentAvoid>t||!o&&!e.includes(1)&&r)return null;let i=new Range;return i.setStartAfter(n),i.setEndAfter(this.root.lastChild),i}get node(){return this.trailingNodes[0]}hasLeadingOverflow(e){return this.rectFilter.get(e).top>this.rootRect.bottom}getBottom(e){return Math.ceil(this.rectFilter.get(e).bottom+i(e,this.root))}hasTrailingOverflow(e){return this.getBottom(e)>Math.floor(this.rootRect.bottom)}}class s extends Map{get(e){if(e instanceof Text)return this.get(e.parentNode);if(!(e instanceof Element))return{breakInsideAvoid:0,breakInsideParentAvoid:0,breakAfter:"auto",breakBefore:"auto",orphans:2,widows:2};if(this.has(e))return super.get(e);let t=this.findInheritedRule(e);return this.set(e,t),t}maxDepth(){return Math.max(...[...this.values()].map(e=>e.breakInsideAvoid))}findInheritedRule(e){let t=this.get(e.parentNode),n=window.getComputedStyle(e),o=this.breakInside(e,n);return{breakInsideAvoid:t.breakInsideAvoid+ +!!o,breakInsideParentAvoid:t.breakInsideAvoid,breakAfter:n.getPropertyValue("break-after"),breakBefore:n.getPropertyValue("break-before"),orphans:parseInt(n.getPropertyValue("--orphans")||n.getPropertyValue("orphans")||2,10),widows:parseInt(n.getPropertyValue("--widows")||n.getPropertyValue("widows")||2,10)}}breakInside(e,t){return["avoid","avoid-page"].includes(t.getPropertyValue("break-inside"))}}function l(o){let r=function*(o){let r,i=new t;i.acceptNode=i.acceptNode.bind(i);let l=function*(t,n){let o=document.createTreeWalker(t,e,n);o.nextNode()&&(yield*function* e(t,n=!1){do{let{currentNode:o}=t;if(o.nodeType===Node.TEXT_NODE){yield["inline",o];continue}let r=n||window.getComputedStyle(o).display.includes("inline");yield[r?"inline":"enter",o],"table-row"===window.getComputedStyle(o).display||!o.matches("picture,video,canvas,object,audio,embed,iframe,svg,math")&&t.firstChild()&&(yield*e(t,r),t.parentNode()),r||(yield["exit",o])}while(t.nextSibling())}(o))}(o,i),u=new s,c=new d({root:o,nodeRules:u,rectFilter:i});for(let[e,t]of l){switch(e){case"enter":if("inline"===r){let e=c;yield c,(c=new d({root:o,nodeRules:u,rectFilter:i})).trailingNodes.unshift(e.lastNode)}c.leadingNodes.push(t);break;case"inline":"exit"===r&&c.leadingNodes.push(t),r!==e&&(yield c,c=new a({root:o,nodeRules:u,rectFilter:i})),c.nodes.push(t);break;case"exit":r!==e&&(yield c,c=new d({root:o,nodeRules:u,rectFilter:i})),c.trailingNodes.unshift(t);break;default:throw Error(`unexpected node type ${e}`)}r=e}yield c,yield new n({root:o,nodeRules:u,rectFilter:i})}(o),i=[],l=!1;for(let e of r){if(!l&&e.force&&!e.overflowing){let t=e.range();if(t)return t}if(!l&&e.overflowing)for(let e of(l=!0,function*(e){for(let t of(yield{disableRules:[]},yield{disableRules:[3]},function*(e){let t=e[0].nodeRules.maxDepth();for(let e=0;e<=t;e+=1)yield e}(e)))yield{disableRules:[3],avoidDepth:t},yield{disableRules:[1,3],avoidDepth:t},yield{disableRules:[1,3,4],avoidDepth:t}}(i)))for(let t of i){let n=t.range(e);if(n)return n}if(l){let t=e.range({disableRules:[1,3,4],avoidDepth:1/0});if(t)return t}else i.unshift(e)}return null}let u=/^(A5|A4|A3|B5|B4|JIS-B5|JIS-B4|letter|legal|ledger|landscape|portrait)(?:\s+(landscape|portrait)$)?/i,c={a5:["148mm","210mm"],a4:["210mm","297mm"],a3:["297mm","420mm"],b5:["176mm","250mm"],b4:["250mm","353mm"],"jis-b5":["182mm","257mm"],"jis-b4":["257mm","364mm"],letter:["8.5in","11in"],legal:["8.5in","14in"],ledger:["11in","17in"]};function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}class h{before(e){this.tables=function(e){let t=[],n=e.startContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentNode),n=n.closest("table");n;)n.dataset.fragmentationUuid=f(),function(e){if(!e.querySelector("col")){let t=[...e.rows[0].cells].reduce((e,t)=>e+t.colSpan,0);for(let n=0;n<t;n+=1){let t=document.createElement("col");t.dataset.fragmenationCol=!0,e.prepend(t)}}[...e.querySelectorAll("col")].forEach(e=>{let{width:t}=e.getBoundingClientRect();t&&(e.style.width=`${Math.ceil(t)}px`)})}(n),t.push(n),n=n.parentNode.closest("table");return t}(e)}after(e){this.tables.forEach(t=>{let n=e.querySelector(`table[data-fragmentation-uuid="${t.dataset.fragmentationUuid}"]`);n&&([...t.querySelectorAll("col[data-fragmentation-col]")].forEach(e=>e.remove()),!n.tHead&&t.tHead&&(n.tHead=t.tHead.cloneNode(!0)),delete n.dataset.fragmentationUuid)})}}function g(e){return e.nodeType===Node.ELEMENT_NODE&&e.matches("li")&&e.getBoundingClientRect().height>0}class p{before(e){this.lists=function(e){let t=[],n=e.startContainer;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentNode),n=n.closest("ol");n;){if(n.dataset.fragmentationUuid=f(),t.push(n),n.reversed){let e=[...n.childNodes].filter(g).length;n.start=e}n=n.parentNode.closest("ol")}return t}(e)}after(e){this.lists.forEach(t=>{let n=[...t.childNodes].filter(g).length,o=e.querySelector(`ol[data-fragmentation-uuid="${t.dataset.fragmentationUuid}"]`);o&&(o.reversed?o.start=t.start-n:o.start=t.start+n,delete o.dataset.fragmentationUuid)})}}class m{before(e){let{startContainer:t}=e;if(t.nodeType===Node.ELEMENT_NODE&&t.matches(".page-content"))return;let n=t;for(n.nodeType===Node.TEXT_NODE&&(n=n.parentNode);n&&!n.matches(".page-content");)n.dataset.fragmentedStart="true",n=n.parentNode}after(e){e.querySelectorAll("[data-fragmented-start=true]").forEach(e=>{delete e.dataset.fragmentedStart,e.dataset.fragmentedEnd="true"})}}function b(e){let t=document.createDocumentFragment();return Array.from(e.childNodes).forEach(e=>{t.appendChild(e)}),t}function y(e){let t=document.querySelector(e);return t?b(t):null}function N(e){return!e.hasChildNodes()||1===e.childNodes.length&&e.firstChild.nodeType===Node.TEXT_NODE&&!e.firstChild.data.trim()}function E(e){return!!(!e||e.collapsed||N(e.cloneContents()))}window.addEventListener("DOMContentLoaded",async()=>{document.body.setAttribute("aria-busy","true")}),window.addEventListener("load",async()=>{await document.fonts.ready,function(){let e,t,n=function(e){if(!(e=e.trim().toLowerCase())||"auto"===e)return c.a4;let t=u.exec(e);if(!t){let t=e.split(/\s+/);return 1===t.length&&t.push(t[0]),t}let[,n,o]=t;["portrait","landscape"].includes(n)&&(o=n,n="a4");let r=[...c[n]];return"landscape"===o&&r.reverse(),r}(window.getComputedStyle(document.body).getPropertyValue("--page-size"));document.documentElement.style.setProperty("--page-width",n[0]),document.documentElement.style.setProperty("--page-height",n[1]);let o=y("body > header"),r=y("body > footer"),i=(t=b((e=document.querySelector("body > main"))||document.body),e?.remove(),t);document.body.innerHTML="";let a=0,d=!1;for(;d||!a||i&&!N(i);){let e=function({footer:e,header:t,pageNumber:n}){let o=document.createElement("div");o.classList.add("page"),o.setAttribute("role","region"),o.setAttribute("aria-label",`Page ${n}`),o.setAttribute("data-page-number",n),o.style.setProperty("--page-number",n),document.body.appendChild(o);let r=document.createElement("div");if(r.classList.add("page-inner"),o.appendChild(r),t){let e=document.createElement("div");e.classList.add("page-header"),r.appendChild(e),e.appendChild(t.cloneNode(!0))}let i=document.createElement("div");if(i.classList.add("page-content"),r.appendChild(i),e){let t=document.createElement("div");t.classList.add("page-footer"),r.appendChild(t),t.appendChild(e.cloneNode(!0))}return i}({footer:r,header:o,pageNumber:a+=1});i&&e.appendChild(i);let t=e.closest(".page");t.dispatchEvent(new CustomEvent("create-page",{bubbles:!0}));let n=l(e);if(E(n)){if(t.dataset.lastPage="true",n=l(e),d)break;E(n)||(delete t.dataset.lastPage,d=!0,n=l(e))}n?(t.dispatchEvent(new CustomEvent("before-fragmentation",{detail:n,bubbles:!0})),i=function(e){let t=[new h,new p,new m];t.forEach(t=>t.before(e));let n=e.extractContents();return t.forEach(e=>e.after(n)),n}(n),t.dispatchEvent(new CustomEvent("after-fragmentation",{detail:i,bubbles:!0}))):i=null}document.body.style.setProperty("--page-count",a),document.body.dataset.pageCount=a,document.body.dispatchEvent(new CustomEvent("fragmentation-finished",{bubbles:!0}))}(),document.body.setAttribute("aria-busy","false"),window.getSelection().empty(),window.scrollTo(0,0)});
//# sourceMappingURL=the_machine_stops.342b76a3.js.map
